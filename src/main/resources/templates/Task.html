<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" th:href="@{https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css}"/>
    <link rel="stylesheet" th:href="@{https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css}" />
    <title>To Do Application</title>
</head>
<body>
    <nav class="navbar navbar-light" style="background-color: #e3f2fd;">
        <h5>To Do Application</h5>
    </nav>
    <div class="container mb-3 mt-3">
        <table class="table table-striped table-bordered mydatatable" style="width: 100%">
            <thead>
                <tr>
                    <td>Task #</td>
                    <td>Description</td>
                    <td>Date</td>
                    <td>Action</td>
                </tr>
            </thead>
            <tbody>
                <tr th:each="result:${taskList}">
                    <td th:text="${result.taskId}">1</td>
                    <td th:text="${result.description}"></td>
                    <td th:text="${result.date}"></td>
                    <td>
                        <input type="hidden" id="taskIdHid" th:value="${result.taskId}">
                        <input type="hidden" id="txtDescriptionHid" th:value="${result.description}">
                        <input type="hidden" id="txtDateHid" th:value="${result.date}">
                        <a class="edit"><button class="btn btn-info" data-toggle="modal" data-target="#UpdateModal">Update</button></a> &nbsp;
                        <a th:href="@{/delete(taskId=${result.taskId})}"><button class="btn btn-danger" >Delete</button></a>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="container">
        <button class="btn btn-success" data-toggle="modal" data-target="#AddModal">Create New</button>
    </div>

    <!-- MODALS start here-->
    <!-- Add modal -->
    <div class = "modal fade" id = "AddModal" tabindex = "-1"
         role = "dialog" aria-labelledby =" exampleModalLabelAdd" aria-hidden = "true">
        <div class = "modal-dialog" role = "document">
            <div class = "modal-content">
                <div class = "modal-header">
                    <h5 class = "modal-title" id = "AddModalLabel">Add Task</h5>
                    <button type = "button" class = "close" data-dismiss = "modal" aria-label = "Close">
                        <span aria-hidden = "true">×</span>
                    </button>
                </div>
                <div class = "modal-body">
                    <form th:action="@{/save}" method="post" th:object="${task}">
                        <div class="row">
                            <div class="form-group col-lg-12">
                                <label>Description</label>
                                <input type="text" class="form-control input-normal" required="required" placeholder="Enter description" th:field="${task.description}"/>
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group col-lg-5">
                                <label>Date</label>
                                <input type="text" class="form-control input-normal" required="required" placeholder="Enter date" th:field="${task.date}"/>
                            </div>
                        </div>
                        <button type = "submit" class = "btn btn-success">Save</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Update modal -->
    <div class = "modal fade" id = "UpdateModal" tabindex = "-1"
         role = "dialog" aria-labelledby =" exampleModalLabelUpdate" aria-hidden = "true">
        <div class = "modal-dialog" role = "document">
            <div class = "modal-content">
                <div class = "modal-header">
                    <h5 class = "modal-title" id = "UpdateModalLabel">Update</h5>
                    <button type = "button" class = "close" data-dismiss = "modal" aria-label = "Close">
                        <span aria-hidden = "true">×</span>
                    </button>
                </div>
                <div class = "modal-body">
                    <form th:action="@{/update}" method="post" th:object="${task}">
                        <div class="row">
                            <div class="form-group col-lg-12">
                                <label>Description</label>
                                <input type="hidden" id="taskId" th:field="${task.taskId}"/>
                                <input type="text" class="form-control input-normal" placeholder="Enter description" id="txtDescription" required="required" th:field="${task.description}"/>
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group col-lg-5">
                                <label>Date</label>
                                <input type="text" class="form-control input-normal" placeholder="Enter date" id="txtDate" required="required" th:field="${task.date}"/>
                            </div>
                        </div>
                        <button type = "submit" class = "btn btn-success">Update</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- MODALS end here-->

    <script th:src="@{https://code.jquery.com/jquery-3.3.1.min.js}"></script>
    <script th:src="@{https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js}"></script>
    <script th:src="@{https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js}"></script>
    <script th:src="@{https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js}"></script>
    <script th:src="@{https://cdn.dataTables.net/1.10.19/js/dataTables.bootstrap4.min.js}"></script>
    <script>
        $(document).ready( function () {

            $('.mydatatable').DataTable();

            $('table .edit').on('click', function () {
                var taskId = $(this).parent().find('#taskIdHid').val();
                var description = $(this).parent().find('#txtDescriptionHid').val();
                var date = $(this).parent().find('#txtDateHid').val();

                $('#UpdateModal #taskId').val(taskId);
                $('#UpdateModal #txtDescription').val(description);
                $('#UpdateModal #txtDate').val(date);
                console.log(description);
            });
        });

    </script>
</body>
</html>